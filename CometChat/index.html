<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>Comet Chat Client</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,target-densitydpi=medium-dpi,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
	<meta name="author" content="JimmyLiu" /><meta name="keywords" content="" /><meta name="description" content="" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" /><script src="http://code.jquery.com/jquery-2.1.1.min.js"></script><script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	<style type="text/css">body,h1,h2,p,div {font-family: "微软雅黑";}</style>
	<script type="text/javascript">
var user = ""; // UrlEncoded user name

var onConnect = function() { // Connect delegation
	document.getElementById("frame").src = "chat.php?connect=1&user="+user+"&rand="+Math.random();
}

// Message delagation, called by <script> tags generated by server
var onMsg = function(name, msg) {
	var board = document.getElementById("board");
	var row = document.createElement("p");
	row.innerHTML = "<em>"+name+"</em> <b>says: </b>"+msg;
	board.insertBefore(row, board.lastChild);

	// Scroll to the bottom of the page
	if ( (board.offsetHeight/document.body.clientHeight) > 4 )
		board.removeChild(board.firstChild);

	// Scroll to the bottom of the page
	document.documentElement.scrollTop = document.documentElement.scrollHeight;
};
window.onload = function() {
	while ( user==null || user.length<=0 )
		user = encodeURIComponent( window.prompt("请输入您的称呼：", "梓桐妹妹") );
	setTimeout("onConnect()",0);
	document.getElementById("frame").onreadystatechange = function() {
		if (this.readyState === "complete") setTimeout("onConnect()",0);
	};
}

function getXHR() { var xmlHttp=null;
	try { xmlHttp=new XMLHttpRequest(); }
	catch (e) { // For IE
		try { xmlHttp=new ActiveXObject("Msxml2.XMLHTTP"); }
		catch (e) { xmlHttp=new ActiveXObject("Microsoft.XMLHTTP"); }
	} return xmlHttp;
}
function sendMsg(msg) { var xhr=null;
	if ( (xhr=getXHR()) ==null ) return null;
	xhr.onreadystatechange = false;
	xhr.open("POST", "chat.php?user="+user, false);
	xhr.send("msg="+encodeURIComponent(msg));
	xhr.onreadystatechange = function() {
		if (ajax.readyState == 4 && ajax.status == 200){}
	};
}
	</script>
</head>
<body>

<div data-role="page">
	<div data-role="header">
		<h1 style="letter-spacing: 0.3em;">聊天室</h1>
	</div>
	<div data-role="content">
		<div id="board"><p>&nbsp;</p></div>
	</div>
	<div data-role="footer" style="position:fixed;left:0;bottom:0;width:100%">
		<textarea rows="1" style="height:30px"></textarea>
	</div>
	<iframe id="frame" style="display:none">Iframe not supported</iframe>
</div>

</body>
</html>